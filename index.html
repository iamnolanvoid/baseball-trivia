<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Baseball Battle</title>
    <script src="stats.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .setup-ui { background: #1e293b; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; border: 1px solid #334155; }
        .game-header { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .player-card { padding: 15px 30px; border-radius: 10px; border: 2px solid #334155; text-align: center; min-width: 150px; }
        .p1-active { border-color: #38bdf8; background: #0c4a6e; }
        .p2-active { border-color: #fb7185; background: #881337; }
        
        .input-area { margin-bottom: 20px; display: flex; gap: 10px; }
        input { padding: 12px; font-size: 1.1em; border-radius: 8px; border: none; width: 250px; outline: none; }
        button { padding: 12px 20px; font-weight: bold; cursor: pointer; border-radius: 8px; border: none; transition: 0.2s; }
        #submit-btn { background: #38bdf8; color: #0f172a; }
        #reset-btn { background: #475569; color: white; font-size: 0.8em; margin-top: 10px; }
        #reset-btn:hover { background: #ef4444; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; width: 100%; max-width: 1100px; }
        .slot { background: #1e293b; padding: 10px; border-radius: 6px; font-size: 0.85em; display: flex; align-items: center; border: 1px solid #334155; transition: 0.3s; }
        .claimed-p1 { background: #0ea5e9; color: white; font-weight: bold; border-color: white; transform: scale(1.02); }
        .claimed-p2 { background: #e11d48; color: white; font-weight: bold; border-color: white; transform: scale(1.02); }
        .rank { opacity: 0.5; margin-right: 10px; font-weight: bold; min-width: 25px; }
    </style>
</head>
<body>

    <div class="setup-ui" id="lobby">
        <h2>Online Multiplayer Setup</h2>
        <select id="category-select">
    <option value="hr">All-Time Home Runs</option>
    <option value="singles">All-Time Singles</option>
    <option value="dwar">All-Time Defensive WAR</option>
</select>
        <p>Pick a side and start guessing!</p>
        <button onclick="joinGame(1)" style="background: #0ea5e9; color: white; margin-right: 10px;">Join as Player 1 (Blue)</button>
        <button onclick="joinGame(2)" style="background: #e11d48; color: white;">Join as Player 2 (Red)</button>
    </div>

    <div class="game-header">
        <div id="card-1" class="player-card">P1 Score: <span id="score-1">0</span></div>
        <div id="card-2" class="player-card">P2 Score: <span id="score-2">0</span></div>
    </div>

    <div class="input-area">
        <input type="text" id="guess-input" placeholder="Enter Full Name or Last Name..." autocomplete="off">
        <button id="submit-btn">GUESS</button>
    </div>

    <div class="grid" id="grid"></div>
    
    <button id="reset-btn">Reset All Game Data</button>

<script>
// --- 1. FIREBASE CONFIG [cite: 2] ---
const firebaseConfig = {
  apiKey: "AIzaSyCUG4KKcbKJYnwrALVuK_bO6YW6O7nPGV8",
  authDomain: "baseballtrivia-b03ee.firebaseapp.com",
  databaseURL: "https://baseballtrivia-b03ee-default-rtdb.firebaseio.com",
  projectId: "baseballtrivia-b03ee",
  storageBucket: "baseballtrivia-b03ee.firebasestorage.app",
  messagingSenderId: "419741114898",
  appId: "1:419741114898:web:8aac29c4d020e4f4dfaecb",
  measurementId: "G-SFQD1XC8NJ"
};

// Initialize Firebase [cite: 3]
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const gameRef = db.ref('game_state');

// --- 2. GAME DATA ---
const leaders = [{"rank": 1, "name": "Barry Bonds", "stat": 762}, {"rank": 2, "name": "Henry Aaron", "stat": 755}, {"rank": 3, "name": "Babe Ruth", "stat": 714}, {"rank": 4, "name": "Albert Pujols", "stat": 703}, {"rank": 5, "name": "Alex Rodriguez", "stat": 696}, {"rank": 6, "name": "Willie Mays", "stat": 660}, {"rank": 7, "name": "Ken Griffey Jr.", "stat": 630}, {"rank": 8, "name": "Jim Thome", "stat": 612}, {"rank": 9, "name": "Sammy Sosa", "stat": 609}, {"rank": 10, "name": "Frank Robinson", "stat": 586}, {"rank": 11, "name": "Mark McGwire", "stat": 583}, {"rank": 12, "name": "Harmon Killebrew", "stat": 573}, {"rank": 13, "name": "Rafael Palmeiro", "stat": 569}, {"rank": 14, "name": "Reggie Jackson", "stat": 563}, {"rank": 15, "name": "Manny Ramirez", "stat": 555}, {"rank": 16, "name": "Mike Schmidt", "stat": 548}, {"rank": 17, "name": "David Ortiz", "stat": 541}, {"rank": 18, "name": "Mickey Mantle", "stat": 536}, {"rank": 19, "name": "Jimmie Foxx", "stat": 534}, {"rank": 20, "name": "Willie McCovey", "stat": 521}, {"rank": 20, "name": "Frank Thomas", "stat": 521}, {"rank": 20, "name": "Ted Williams", "stat": 521}, {"rank": 23, "name": "Ernie Banks", "stat": 512}, {"rank": 23, "name": "Eddie Mathews", "stat": 512}, {"rank": 25, "name": "Miguel Cabrera", "stat": 511}, {"rank": 25, "name": "Mel Ott", "stat": 511}, {"rank": 27, "name": "Gary Sheffield", "stat": 509}, {"rank": 28, "name": "Eddie Murray", "stat": 504}, {"rank": 29, "name": "Lou Gehrig", "stat": 493}, {"rank": 29, "name": "Fred McGriff", "stat": 493}, {"rank": 31, "name": "Adrian Beltré", "stat": 477}, {"rank": 32, "name": "Stan Musial", "stat": 475}, {"rank": 32, "name": "Willie Stargell", "stat": 475}, {"rank": 34, "name": "Carlos Delgado", "stat": 473}, {"rank": 35, "name": "Chipper Jones", "stat": 468}, {"rank": 36, "name": "Dave Winfield", "stat": 465}, {"rank": 37, "name": "Nelson Cruz", "stat": 464}, {"rank": 38, "name": "José Canseco", "stat": 462}, {"rank": 38, "name": "Adam Dunn", "stat": 462}, {"rank": 40, "name": "Giancarlo Stanton", "stat": 453}, {"rank": 41, "name": "Carl Yastrzemski", "stat": 452}, {"rank": 42, "name": "Jeff Bagwell", "stat": 449}, {"rank": 42, "name": "Vladimir Guerrero", "stat": 449}, {"rank": 44, "name": "Dave Kingman", "stat": 442}, {"rank": 45, "name": "Jason Giambi", "stat": 440}, {"rank": 46, "name": "Paul Konerko", "stat": 439}, {"rank": 47, "name": "Andre Dawson", "stat": 438}, {"rank": 48, "name": "Carlos Beltrán", "stat": 435}, {"rank": 49, "name": "Juan González", "stat": 434}, {"rank": 49, "name": "Andruw Jones", "stat": 434}, {"rank": 51, "name": "Cal Ripken Jr.", "stat": 431}, {"rank": 52, "name": "Mike Piazza", "stat": 427}, {"rank": 53, "name": "Billy Williams", "stat": 426}, {"rank": 54, "name": "Edwin Encarnación", "stat": 424}, {"rank": 55, "name": "Darrell Evans", "stat": 414}, {"rank": 56, "name": "Alfonso Soriano", "stat": 412}, {"rank": 57, "name": "Mark Teixeira", "stat": 409}, {"rank": 58, "name": "Duke Snider", "stat": 407}, {"rank": 59, "name": "Mike Trout", "stat": 404}, {"rank": 60, "name": "Andrés Galarraga", "stat": 399}, {"rank": 60, "name": "Al Kaline", "stat": 399}, {"rank": 62, "name": "Dale Murphy", "stat": 398}, {"rank": 63, "name": "Joe Carter", "stat": 396}, {"rank": 64, "name": "Jim Edmonds", "stat": 393}, {"rank": 65, "name": "Graig Nettles", "stat": 390}, {"rank": 66, "name": "Johnny Bench", "stat": 389}, {"rank": 67, "name": "Aramis Ramírez", "stat": 386}, {"rank": 68, "name": "Dwight Evans", "stat": 385}, {"rank": 69, "name": "Harold Baines", "stat": 384}, {"rank": 70, "name": "Larry Walker", "stat": 383}, {"rank": 71, "name": "Frank Howard", "stat": 382}, {"rank": 71, "name": "Ryan Howard", "stat": 382}, {"rank": 71, "name": "Jim Rice", "stat": 382}, {"rank": 74, "name": "Albert Belle", "stat": 381}, {"rank": 75, "name": "Orlando Cepeda", "stat": 379}, {"rank": 75, "name": "Tony Pérez", "stat": 379}, {"rank": 77, "name": "Matt Williams", "stat": 378}, {"rank": 78, "name": "Norm Cash", "stat": 377}, {"rank": 78, "name": "Jeff Kent", "stat": 377}, {"rank": 80, "name": "Carlton Fisk", "stat": 376}, {"rank": 81, "name": "Rocky Colavito", "stat": 374}, {"rank": 82, "name": "Paul Goldschmidt", "stat": 372}, {"rank": 83, "name": "Gil Hodges", "stat": 370}, {"rank": 84, "name": "Todd Helton", "stat": 369}, {"rank": 84, "name": "Ralph Kiner", "stat": 369}, {"rank": 84, "name": "Manny Machado", "stat": 369}, {"rank": 87, "name": "Aaron Judge", "stat": 368}, {"rank": 88, "name": "Freddie Freeman", "stat": 367}, {"rank": 89, "name": "Lance Berkman", "stat": 366}, {"rank": 90, "name": "Bryce Harper", "stat": 363}, {"rank": 91, "name": "Joe DiMaggio", "stat": 361}, {"rank": 92, "name": "Gary Gaetti", "stat": 360}, {"rank": 93, "name": "Johnny Mize", "stat": 359}, {"rank": 94, "name": "Yogi Berra", "stat": 358}, {"rank": 94, "name": "Carlos Lee", "stat": 358}, {"rank": 96, "name": "Joey Votto", "stat": 356}, {"rank": 97, "name": "Greg Vaughn", "stat": 355}, {"rank": 98, "name": "Luis Gonzalez", "stat": 354}, {"rank": 99, "name": "Lee May", "stat": 354}, {"rank": 100, "name": "Nolan Arenado", "stat": 353}];

// --- 3. MULTIPLAYER LOGIC ---
let myPlayerNum = null;
let claimedNames = {};

function joinGame(num) {
    myPlayerNum = num;
    document.getElementById('lobby').style.display = 'none';
    document.getElementById(`card-${num}`).classList.add(num === 1 ? 'p1-active' : 'p2-active');
}

const normalize = (s) => s ? s.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim() : "";

function createGrid() {
    const gridEl = document.getElementById('grid');
    gridEl.innerHTML = '';
    leaders.forEach((p, i) => {
        const div = document.createElement('div');
        div.className = 'slot';
        div.id = `rank-${i}`;
        div.innerHTML = `<span class="rank">${p.rank}</span> ???`;
        gridEl.appendChild(div);
    });
}

function handleGuess() {
    if (!myPlayerNum) return alert("Please join as Player 1 or Player 2 first!");
    const input = document.getElementById('guess-input');
    const val = normalize(input.value);
    
    const index = leaders.findIndex(p => {
        if (claimedNames[p.name]) return false;
        const fullName = normalize(p.name);
        const lastName = fullName.split(' ').pop();
        return val === fullName || val === lastName;
    });

    if (index !== -1) {
        const p = leaders[index];
        gameRef.child('claims').child(p.name).set({
            player: myPlayerNum,
            rank: p.rank,
            realName: p.name
        });
        input.value = '';
    }
}

// Global Reset
document.getElementById('reset-btn').addEventListener('click', () => {
    if(confirm("Are you sure? This will clear the board for everyone!")) {
        gameRef.set({ claims: {} });
    }
});

// Sync from Firebase
gameRef.child('claims').on('value', (snapshot) => {
    const data = snapshot.val() || {};
    claimedNames = data;
    
    // Clear the board visual first
    createGrid();
    
    let scores = {1: 0, 2: 0};
    
    Object.values(data).forEach(claim => {
        scores[claim.player] += claim.rank;
        const idx = leaders.findIndex(l => l.name === claim.realName);
        const slot = document.getElementById(`rank-${idx}`);
        if (slot) {
            slot.className = `slot claimed-p${claim.player}`;
            slot.innerHTML = `<span class="rank">${claim.rank}</span> ${claim.realName}`;
        }
    });
    
    document.getElementById('score-1').textContent = scores[1];
    document.getElementById('score-2').textContent = scores[2];
});

document.getElementById('submit-btn').addEventListener('click', handleGuess);
document.getElementById('guess-input').addEventListener('keypress', (e) => { if(e.key==='Enter') handleGuess(); });

createGrid();
</script>
</body>
</html>

